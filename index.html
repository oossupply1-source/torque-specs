<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Torque Specs & Oils</title>
<style>
body { font-family: system-ui, -apple-system; background: #0f0f0f; color: #fff; margin:0; padding:16px;}
h1{text-align:center;margin-bottom:10px;}
select,input,button{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:none;font-size:16px;}
button{background:#222;color:#fff;}
button.active{background:#007aff;}
.card{background:#1b1b1b;border-radius:10px;padding:12px;margin-top:10px;}
.spec{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #333;}
.spec:last-child{border-bottom:none;}
.star{cursor:pointer;margin-left:8px;}
.small{font-size:12px;opacity:0.6;text-align:center;}
</style>
</head>
<body>

<h1>Torque Specs & Oils</h1>

<select id="vehicleSelect" onchange="loadEngines()">
  <option value="">Select Vehicle</option>
</select>

<select id="engineSelect" onchange="loadSpecs()">
  <option value="">Select Engine</option>
</select>

<input type="text" id="search" placeholder="Search Parts..." oninput="filterSpecs()">

<button id="unitBtn" onclick="toggleUnits()">Units: ft-lb</button>

<div class="card" id="results"></div>

<script>
// ---------------- STATE ----------------
let torqueData = {};
let currentVehicle = "";
let currentEngine = "";
let currentSpecs = {};
let unit = localStorage.getItem("unit") || "ft";
let favorites = JSON.parse(localStorage.getItem("favorites") || "{}");

// ---------------- FUNCTIONS ----------------
async function loadBrandData(){
    const brands = ["toyota","lexus","honda","bmw","ford"];
    let allData = {};
    for(const brand of brands){
        const res = await fetch(`${brand}.json`);
        const data = await res.json();
        allData = {...allData,...data};
    }
    torqueData = allData;
    populateVehicleDropdown();
}

function populateVehicleDropdown(){
    const vehicleSelect = document.getElementById("vehicleSelect");
    Object.keys(torqueData).forEach(key=>{
        const option = document.createElement("option");
        option.value = key;
        const v = torqueData[key].models.join(", ");
        option.text = `${key.toUpperCase()} (${v})`;
        vehicleSelect.appendChild(option);
    });
}

function loadEngines(){
    currentVehicle = document.getElementById("vehicleSelect").value;
    currentEngine = "";
    const engineSelect = document.getElementById("engineSelect");
    engineSelect.innerHTML = '<option value="">Select Engine</option>';
    if(currentVehicle && torqueData[currentVehicle].engines){
        Object.keys(torqueData[currentVehicle].engines).forEach(eng=>{
            const option = document.createElement("option");
            option.value = eng;
            option.text = eng;
            engineSelect.appendChild(option);
        });
    }
}

function loadSpecs(){
    const engineSelect = document.getElementById("engineSelect");
    currentEngine = engineSelect.value;
    if(currentVehicle && currentEngine){
        currentSpecs = torqueData[currentVehicle].engines[currentEngine];
        renderSpecs(currentSpecs);
    }
}

function renderSpecs(specs){
    const results = document.getElementById("results");
    results.innerHTML = "";
    for(const category in specs){
        const catData = specs[category];
        const catDiv = document.createElement("div");
        catDiv.className="card";
        const h = document.createElement("h3");
        h.innerText = category.toUpperCase();
        catDiv.appendChild(h);
        for(const part in catData){
            const val = catData[part];
            const display = val!==null ? convert(val) : "N/A";
            const favKey = currentVehicle+currentEngine+part;
            const star = favorites[favKey] ? "⭐" : "☆";
            const div = document.createElement("div");
            div.className="spec";
            div.innerHTML=`<span><strong>${part}</strong></span><span>${display}<span class="star" onclick="toggleFav('${favKey}')">${star}</span></span>`;
            catDiv.appendChild(div);
        }
        results.appendChild(catDiv);
    }
}

function filterSpecs(){
    const term = document.getElementById("search").value.toLowerCase();
    if(!currentSpecs) return;
    const filtered = {};
    for(const cat in currentSpecs){
        filtered[cat]={};
        for(const part in currentSpecs[cat]){
            if(part.toLowerCase().includes(term)){
                filtered[cat][part]=currentSpecs[cat][part];
            }
        }
        if(Object.keys(filtered[cat]).length===0) delete filtered[cat];
    }
    renderSpecs(filtered);
}

function toggleUnits(){
    unit = unit==="ft"?"nm":"ft";
    localStorage.setItem("unit",unit);
    document.getElementById("unitBtn").textContent="Units: "+(unit==="ft"?"ft-lb":"Nm");
    renderSpecs(currentSpecs);
}

function convert(value){
    if(unit==="ft") return value+" ft-lb";
    return Math.round(value*1.356)+" Nm";
}

function toggleFav(key){
    favorites[key]=!favorites[key];
    localStorage.setItem("favorites",JSON.stringify(favorites));
    renderSpecs(currentSpecs);
}

// ---------------- INIT ----------------
loadBrandData();
document.getElementById("unitBtn").textContent = "Units: "+(unit==="ft"?"ft-lb":"Nm");
</script>

</body>
</html>
